# Реализация логирования с помощью Spring AOP

## 1. Введение

**Название проекта:** Реализация логирования с помощью Spring AOP  
**Цель:** Создать пример использования Spring AOP для логирования операций в приложении, имитирующем управление пользователями и их заказами.

## 2. Описание проекта

Проект представляет собой простое Spring Boot приложение, которое управляет пользователями и их заказами. В приложении реализована система логирования на основе Spring AOP для отслеживания операций, выполняемых в сервисах.

## 3. Структура проекта

### Настройка проекта

Проект создан с помощью Spring Initializr.  
В `pom.xml` добавлены зависимости:

- Spring Web
- Spring Data JPA
- Spring AOP
- Log4j2 для логирования

### Создание сущностей

#### User

- Поля: `id`, `name`, `email`, `orders`

#### Order

- Поля: `id`, `description`, `status`, `user`

Связь между сущностями: Один пользователь может иметь несколько заказов (отношение "один ко многим").

### Создание репозиториев

- **UserRepository:** Интерфейс для работы с сущностью `User`, расширяющий `JpaRepository`.
- **OrderRepository:** Интерфейс для работы с сущностью `Order`, расширяющий `JpaRepository`.

### Создание сервисов

- **UserService:**
  - Методы:
    - Постраничное получение пользователей
    - Поиск пользователя по `id`
    - Получение списка пользователей по задаваемым как параметры `ids`
    - Создание пользователя
    - Добавление существующего заказа пользователю
    - Удаление пользователя
    - Удаление нескольких пользователей

- **OrderService:**
  - Методы аналогичные методам пользователя, но для `Order`.

### Создание аспекта

- **LoggingAspect:** Класс для реализации логирования с использованием Spring AOP.
- Логирование выполняется при вызове методов сервисов с использованием аннотаций AOP (`@Before`, `@AfterReturning`, `@AfterThrowing`).
- Были созданы `joinpoint`-ы для демонстрации AOP и логирования нескольких методов:
  - `findUserById`
  - `findOrderById`
  - `addOrder`

### Настройка логирования

Конфигурационный файл `log4j2.xml` настроен для вывода логов в консоль.  
В настройках `log4j2.xml` добавлены необходимые аппендеры и уровни логирования.

## 4. Развертывание приложения

### Пример развертывания с использованием Docker

Для быстрого развертывания приложения был написан `Dockerfile`. Поэтому предлагается развертывать по следующим шагам:

1. Склонировать проект с репозитория:
    ```bash
    git clone <URL вашего репозитория>
    ```

2. Перейти в корень проекта:
    ```bash
    cd <директория_проекта>
    ```

3. Выполнить команду:
    ```bash
    mvn clean verify
    ```
    _(Для этого должен быть установлен Maven)_

4. Собрать Docker-образ командой:
    ```bash
    docker build -t aop:latest .
    ```
    _(aop:latest - для примера названия образа, можно написать свое, если не писать, Docker сгенерирует его случайным образом)_

5. Запустить сборку и осуществить запуск контейнера командой:
    ```bash
    docker run --name aop --network=host -td aop:latest
    ```
    _(где aop:latest название образа, вместо него можно поставить ID)_

### Другой способ

1. Склонировать проект с репозитория:
    ```bash
    git clone <URL вашего репозитория>
    ```

2. Перейти в корень проекта:
    ```bash
    cd <директория_проекта>
    ```

3. Выполнить команду:
    ```bash
    mvn clean verify
    ```
    _(Для этого должен быть установлен Maven)_

4. Ввести команду для запуска:
    ```bash
    java -jar ./target/t1aop-0.0.1-SNAPSHOT.jar
    ```
    _(ВНИМАНИЕ: использовалась Java 21, поэтому должна быть установлена версия аналогичная для корректной работы)_

### Подключение к базе данных

Для работы приложения необходимо использовать СУБД PostgreSQL с настройками, указанными в файле `application.yml` (либо изменить их).  

SQL скрипты создания отношений в БД:

```sql
CREATE TABLE public.orders (
    id UUID NOT NULL PRIMARY KEY,
    description VARCHAR(255),
    status VARCHAR(255),
    user_id UUID
);

CREATE TABLE public.users (
    id UUID NOT NULL PRIMARY KEY,
    name VARCHAR(255),
    email VARCHAR(255)
);
